@echo off
setlocal enabledelayedexpansion

:: ------------------------------------------------------------------
:: [ì„¤ì •] í”„ë¡œì íŠ¸ ë³€ìˆ˜ ì •ì˜
:: ------------------------------------------------------------------
set "PROJECT_NAME=SAM3_FaceDetailer_Ultimate"
set "VENV_DIR=venv"
set "PYTHON_EXEC=python"

:: ì½˜ì†” í•œê¸€ ê¹¨ì§ ë°©ì§€ (UTF-8)
chcp 65001 > nul

echo ================================================================
echo  ðŸš€ %PROJECT_NAME% Launcher
echo ================================================================

:: 1. ê°€ìƒí™˜ê²½(venv) í™•ì¸ ë° ìƒì„±
if not exist "%VENV_DIR%" (
    echo [INFO] ê°€ìƒí™˜ê²½ í´ë” '%VENV_DIR%' ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤...
    %PYTHON_EXEC% -m venv %VENV_DIR%
    
    if errorlevel 1 (
        echo [ERROR] ê°€ìƒí™˜ê²½ ìƒì„± ì‹¤íŒ¨ - Python 3.10 ì´ìƒì´ ì„¤ì¹˜ë˜ì–´ ìžˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
        pause
        exit /b
    )
    echo [INFO] ê°€ìƒí™˜ê²½ ìƒì„± ì™„ë£Œ.
)

:: 2. ê°€ìƒí™˜ê²½ í™œì„±í™”
call %VENV_DIR%\Scripts\activate.bat

:: 3. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° ì—…ë°ì´íŠ¸
if exist "requirements.txt" (
    echo [INFO] ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„±ì„ í™•ì¸í•©ë‹ˆë‹¤...
    :: -q ì˜µì…˜ìœ¼ë¡œ ì´ë¯¸ ì„¤ì¹˜ëœ í•­ëª©ì€ ì¡°ìš©ížˆ ë„˜ì–´ê°
    pip install -r requirements.txt
    
    if errorlevel 1 (
        echo [WARNING] ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. - ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸ í•„ìš”
        pause
    )
) else (
    echo [WARNING] 'requirements.txt' íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. íŒ¨í‚¤ì§€ ì„¤ì¹˜ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.
)

:: 4. ë©”ì¸ í”„ë¡œê·¸ëž¨ ì‹¤í–‰
echo.
echo [INFO] ë©”ì¸ í”„ë¡œê·¸ëž¨ main.py ì„ ì‹¤í–‰í•©ë‹ˆë‹¤...
echo ----------------------------------------------------------------

python main.py

:: 5. ì¢…ë£Œ í›„ ì²˜ë¦¬
if errorlevel 1 (
    echo.
    echo ----------------------------------------------------------------
    echo [ERROR] í”„ë¡œê·¸ëž¨ì´ ë¹„ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
    echo ìœ„ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.
    pause
) else (
    echo.
    echo [INFO] í”„ë¡œê·¸ëž¨ì´ ì •ìƒ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
    timeout /t 3 > nul
)